---
import { getCollection } from 'astro:content';
import RecursiveList from '../components/RecursiveList.jsx';

const docs = await getCollection('docs');

function buildTree(docs) {
  const root = {};

  for (const doc of docs) {
    const parts = doc.id.split('/');
    let current = root;

    for (let i = 0; i < parts.length - 1; i++) {
      const part = parts[i];
      if (!current[part]) current[part] = {};
      current = current[part];
    }

    if (!current.__docs) current.__docs = [];
    current.__docs.push({ ...doc, slug: doc.id });
  }

  return root;
}

const docTree = buildTree(docs);
---

<ul>
  <RecursiveList node={docTree} />
</ul>